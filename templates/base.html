<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Patient {{ patient.id }}{% endblock %} — Clinical Workbench</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    {% block head %}{% endblock %}
    <style>
        /* ── Reset ──────────────────────────────────────────────────────────── */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f8fafc;
            color: #1e293b;
            line-height: 1.5;
            /* Reserve space for the sticky top bar */
            padding-top: 64px;
        }

        /* ── Top Navigation Bar ─────────────────────────────────────────────── */
        .topnav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 200;
            height: 64px;
            background: #ffffff;
            border-bottom: 1px solid #e2e8f0;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.06);

            /* Three-column layout: left takes remaining space, center shrinks to
               content (always truly centered), right mirrors the left width. */
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            align-items: center;
            padding: 0 32px;
            gap: 16px;
        }

        /* ── Left section: back arrow + patient ID + risk badge ─────────────── */
        .topnav-left {
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 0;           /* allow text to truncate if viewport is narrow */
        }

        .back-link {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border-radius: 8px;
            color: #64748b;
            text-decoration: none;
            flex-shrink: 0;
            transition: background 0.15s, color 0.15s;
        }

        .back-link:hover {
            background: #f1f5f9;
            color: #334155;
        }

        .patient-label {
            font-size: 15px;
            font-weight: 600;
            color: #1e293b;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Risk badge — matches existing status-badge color conventions */
        .risk-badge {
            display: inline-flex;
            align-items: center;
            padding: 3px 10px;
            border-radius: 9999px;
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 0.02em;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .risk-high {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        .risk-medium {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fde68a;
        }

        .risk-low {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }

        /* ── Center section: tab navigation ────────────────────────────────── */
        .tab-nav {
            display: flex;
            align-items: center;
            gap: 2px;
            background: #f1f5f9;
            border-radius: 9999px;
            padding: 3px;
        }

        .tab {
            display: inline-block;
            padding: 7px 16px;
            border-radius: 9999px;
            font-size: 13px;
            font-weight: 500;
            color: #64748b;
            text-decoration: none;
            white-space: nowrap;
            transition: background 0.15s, color 0.15s;
            line-height: 1.4;
        }

        .tab:hover:not(.tab-active) {
            background: rgba(0, 0, 0, 0.05);
            color: #334155;
        }

        .tab-active {
            background: #5B21B6;
            color: #ffffff;
            box-shadow: 0 1px 4px rgba(91, 33, 182, 0.35);
        }

        /* ── Right section: export button + avatar ──────────────────────────── */
        .topnav-right {
            display: flex;
            align-items: center;
            gap: 12px;
            justify-content: flex-end;
        }

        .btn-export {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            border: 1.5px solid #e2e8f0;
            border-radius: 8px;
            background: #ffffff;
            color: #334155;
            font-family: inherit;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
            transition: background 0.15s, border-color 0.15s, box-shadow 0.15s;
        }

        .btn-export:hover {
            background: #f8fafc;
            border-color: #cbd5e1;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
        }

        .btn-export:active {
            background: #f1f5f9;
        }

        /* Avatar matches the dashboard.html gradient circle */
        .avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ffffff;
            font-weight: 600;
            font-size: 13px;
            flex-shrink: 0;
            user-select: none;
        }

        /* ── Main content area ──────────────────────────────────────────────── */
        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 28px 32px;
        }

        /* ── Shared card primitive (available to all child templates) ────────── */
        .card {
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        }

        /* ── SVG utility (prevents layout shift from inline SVGs) ───────────── */
        svg {
            flex-shrink: 0;
        }

        /* ── Responsive: narrow screens ─────────────────────────────────────── */
        @media (max-width: 900px) {
            .topnav {
                padding: 0 16px;
            }

            .tab {
                padding: 7px 10px;
                font-size: 12px;
            }

            .btn-export span {
                display: none;   /* hide button label, keep icon */
            }

            .main-content {
                padding: 20px 16px;
            }
        }

        @media (max-width: 680px) {
            /* Stack the nav into two rows on very small screens */
            .topnav {
                height: auto;
                grid-template-columns: 1fr 1fr;
                grid-template-rows: auto auto;
                padding: 10px 16px;
                gap: 8px;
            }

            body {
                padding-top: 112px;
            }

            .tab-nav {
                grid-column: 1 / -1;
                justify-content: center;
                overflow-x: auto;
            }
        }
    </style>
</head>
<body>

    <!-- ═══════════════════════════════════════════════════════════════════════
         TOP NAVIGATION BAR
         ═══════════════════════════════════════════════════════════════════════ -->
    <nav class="topnav" role="navigation" aria-label="Patient navigation">

        <!-- Left: back arrow · patient ID · risk badge -->
        <div class="topnav-left">
            <a href="/" class="back-link" title="Back to Dashboard" aria-label="Back to Dashboard">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none"
                     stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                     aria-hidden="true">
                    <path d="M19 12H5"/>
                    <path d="M12 19l-7-7 7-7"/>
                </svg>
            </a>

            <span class="patient-label">Patient {{ patient.id }}</span>

            {# Risk badge — color depends on patient.risk_level.
               The existing app.py dict uses 'status'; the new adapters set 'risk_level'.
               We check both so the base template works during the transition. #}
            {% set risk = patient.risk_level if patient.risk_level is defined and patient.risk_level else '' %}
            {% if risk == 'high' %}
                <span class="risk-badge risk-high" aria-label="High Risk patient">High Risk</span>
            {% elif risk == 'medium' %}
                <span class="risk-badge risk-medium" aria-label="Medium Risk patient">Medium Risk</span>
            {% elif risk == 'low' %}
                <span class="risk-badge risk-low" aria-label="Low Risk patient">Low Risk</span>
            {% endif %}
        </div>

        <!-- Center: tab pill group (centered via CSS grid 1fr/auto/1fr) -->
        <div class="tab-nav" role="tablist" aria-label="Patient view tabs">
            <a href="/patient/{{ patient.id }}"
               class="tab {% if active_tab == 'overview' %}tab-active{% endif %}"
               role="tab"
               aria-selected="{{ 'true' if active_tab == 'overview' else 'false' }}">
                Overview
            </a>
            <a href="/patient/{{ patient.id }}/data-explorer"
               class="tab {% if active_tab == 'data-explorer' %}tab-active{% endif %}"
               role="tab"
               aria-selected="{{ 'true' if active_tab == 'data-explorer' else 'false' }}">
                Data Explorer
            </a>
            <a href="/patient/{{ patient.id }}/model-lab"
               class="tab {% if active_tab == 'model-lab' %}tab-active{% endif %}"
               role="tab"
               aria-selected="{{ 'true' if active_tab == 'model-lab' else 'false' }}">
                Model Lab
            </a>
            <a href="/patient/{{ patient.id }}/tournament"
               class="tab {% if active_tab == 'tournament' %}tab-active{% endif %}"
               role="tab"
               aria-selected="{{ 'true' if active_tab == 'tournament' else 'false' }}">
                Tournament
            </a>
            <a href="/patient/{{ patient.id }}/ai-assistant"
               class="tab {% if active_tab == 'ai-assistant' %}tab-active{% endif %}"
               role="tab"
               aria-selected="{{ 'true' if active_tab == 'ai-assistant' else 'false' }}">
                AI Assistant
            </a>
        </div>

        <!-- Right: export button + user avatar -->
        <div class="topnav-right">
            <button class="btn-export" type="button" title="Export patient findings as PDF">
                <!-- Download icon -->
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
                     stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                     aria-hidden="true">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                    <polyline points="7 10 12 15 17 10"/>
                    <line x1="12" y1="15" x2="12" y2="3"/>
                </svg>
                <span>Export Findings</span>
            </button>

            <div class="avatar" title="Dr. A. Buckholz" aria-label="Logged-in user: AB">AB</div>
        </div>

    </nav><!-- /.topnav -->


    <!-- ═══════════════════════════════════════════════════════════════════════
         PAGE CONTENT  (child templates fill this block)
         ═══════════════════════════════════════════════════════════════════════ -->
    <main class="main-content">
        {% block content %}{% endblock %}
    </main>


    <!-- ═══════════════════════════════════════════════════════════════════════
         PAGE-SPECIFIC SCRIPTS  (child templates inject here)
         ═══════════════════════════════════════════════════════════════════════ -->
    {% block scripts %}{% endblock %}

</body>
</html>
